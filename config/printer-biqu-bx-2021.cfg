[tmc2209 stepper_z1]
uart_pin: PC8
run_current: 1
sense_resistor: 0.15
stealthchop_threshold: 999999

[tmc2209 extruder]
uart_pin: PI8
run_current: 0.8
sense_resistor: 0.15
stealthchop_threshold: 0

[controller_fan controller_fan]
pin: PA7
idle_timeout: 300 # 5 minute timeout

[display_status]

[gcode_button lcd_button]
pin: PH8
press_gcode:
    SET_PIN PIN=screen VALUE=1
    SET_LED LED=led BLUE=1.0 RED=1.0 GREEN=1.0

[neopixel led]
pin: PH3
chain_count: 15

[neopixel knob]
pin: PB1
chain_count: 2

[mcu]
serial: /dev/ttyAMA0
restart_method: command

[printer]
kinematics: cartesian
max_velocity: 200
max_accel: 1000
max_z_velocity: 10
max_z_accel: 1000

[stepper_x]
step_pin: PG13
dir_pin: !PG12
enable_pin: !PG14
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 400
endstop_pin: tmc2209_stepper_x:virtual_endstop
position_min: -13
position_endstop: -13
position_max: 250
homing_speed: 30
homing_retract_dist: 0

[stepper_y]
step_pin: PB3
dir_pin: !PD3
enable_pin: !PB4
rotation_distance: 40
microsteps: 16
full_steps_per_rotation: 400
endstop_pin: tmc2209_stepper_y:virtual_endstop
position_min: -7
position_endstop: -7
position_max: 250
homing_speed: 30
homing_retract_dist: 0

[stepper_z]
step_pin: PD7
dir_pin: PD6
enable_pin: !PG9
rotation_distance: 8
microsteps: 16
full_steps_per_rotation: 400
endstop_pin: probe:z_virtual_endstop
position_min: -2
position_max: 250

[extruder]
step_pin: PC14
dir_pin: !PC13
enable_pin: !PC15
microsteps: 16
rotation_distance: 24.031
full_steps_per_rotation: 200
gear_ratio: 7:1
nozzle_diameter: 0.4
filament_diameter: 1.75
heater_pin: PC4
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PH4
control: pid
pid_Kp: 22.2
pid_Ki: 1.08
pid_Kd: 114
min_temp: 0
max_temp: 350

[heater_bed]
heater_pin: PA4
sensor_type: EPCOS 100K B57560G104F
sensor_pin: PH5
control: watermark
min_temp: 0
max_temp: 250

[bed_mesh]
speed: 120
mesh_min: 10,19.78
mesh_max: 219.9,230
probe_count: 4,4

[screws_tilt_adjust]
screw3: 245,179
screw3_name: rear right
screw4: 58,179
screw4_name: rear left
# slicer setup: "print_start NOZZLE=<temp> BED=<temp>
# the temps passed in. examples:
# cura: PRINT_START BED={material_bed_temperature_layer_0} NOZZLE={material_print_temperature_layer_0}
# prusaslicer: PRINT_START NOZZLE=[first_layer_temperature] BED=[bed_temperature]
screw1: 58,-7
screw1_name: front left
screw2: 245,-7
screw2_name: front right
speed: 100
screw_thread: CCW-M3

[safe_z_home]
home_xy_position: 125,125
speed: 200
z_hop: 10
z_hop_speed: 25

[gcode_macro PRINT_START]
gcode:
    # Turn on screen if it's not on
    SET_PIN PIN=screen VALUE=1
    G28
    G0 Z1
    # Warm up nozzle, not to full temps yet
    M104 S150
    # Set LED to Purple for bed heating
    SET_LED LED=led BLUE=0.94 RED=0.63 GREEN=0.13
    M117 Heating Bed
    # Allow probe to warm up, then re-home Z
    M190 S60
    M105
    G4 P90000
    G28 Z
    M190 S{params.BED}
    M105
    G90 # Ensure we are in absolute mode
    G21
    M83 # Set the extruder to relative mode
    G92 E0
    # Set LED to Red for nozzle heating
    SET_LED LED=led BLUE=0.0 RED=1.0 GREEN=0.0
    M117 Heating Nozzle
    G0 X2 Y0 F6000
    G0 Z0.4
    M109 S{params.NOZZLE}
    M105
    # Set LED to white for printing
    SET_LED LED=led BLUE=1.0 RED=1.0 GREEN=1.0
    M117 Printing
    # Purge Line
    G1 X120 E30 F1200
    G1 Y1
    G1 X2 E30 F1200
    G92 E0
    G1 Z1.0 F600
    G92 E0
    G0 F9000
    G90 # Set back to Absolute mode

[delayed_gcode welcome]
gcode:
    SET_LED LED=knob RED=0.0 BLUE=1.0 GREEN=0.0
    SET_LED LED=led RED=0.0 BLUE=1.0 GREEN=0.0
    G4 P1000
    SET_LED LED=led RED=1.0 BLUE=0.0 GREEN=0.0
    G4 P1000
    SET_LED LED=led RED=0.0 BLUE=0.0 GREEN=1.0
    G4 P1000
    SET_LED LED=led RED=1.0 BLUE=1.0 GREEN=1.0
initial_duration: 0.1

[idle_timeout]
gcode:
    TURN_OFF_HEATERS
    M84
    SET_PIN PIN=screen VALUE=0
    SET_LED LED=led BLUE=0.0 RED=0.0 GREEN=0.0

[pause_resume]

[probe]
pin: PH2
x_offset: -30.1
y_offset: 26.78
z_offset: 0
samples: 3
sample_retract_dist: 3
samples_result: median
samples_tolerance: 0.006
samples_tolerance_retries: 5

[stepper_z1]
full_steps_per_rotation: 400
step_pin: PA8
dir_pin: PC9
enable_pin: !PD2
microsteps: 16
rotation_distance: 8

[fan]
pin: PA5

[heater_fan extruder_fan]
pin: PA6

[output_pin motor_power]
pin: PI11
value: 1

[output_pin screen]
pin: PB5
value: 1

[output_pin beeper]
pin: PA14
pwm: True
cycle_time: 0.001

[tmc2209 stepper_x]
uart_pin: PG10
run_current: 0.8
sense_resistor: 0.15
stealthchop_threshold: 999999
driver_SGTHRS: 127
diag_pin: ^PB11

[tmc2209 stepper_z]
uart_pin: PD5
run_current: 1
sense_resistor: 0.15
stealthchop_threshold: 999999

[tmc2209 stepper_y]
uart_pin: PD4
run_current: 0.8
sense_resistor: 0.15
stealthchop_threshold: 999999
driver_SGTHRS: 137
diag_pin: ^PB12
